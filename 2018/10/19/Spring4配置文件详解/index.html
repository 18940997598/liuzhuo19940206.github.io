<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#333333">
    <meta name="msapplication-TileColor" content="#333333">
    
    
    
    <meta name="keywords" content="Life, ARIA, Hexo, liuzhuo, Cakki, gakki">
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-chrome-192x192.png">
    
    
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    
    
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#333333">
    
    
    <link rel="manifest" href="/favicons/site.webmanifest">
    
    
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    
    
    <link rel="alternate" href="/atom.xml" title="解忧杂货店" type="application/atom+xml" />
    
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
    
    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/css/atom-one-dark.css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    <script defer src="/js/busuanzi.pure.mini.js"></script>
    
    
    <script defer type="text/javascript" src="/js/search.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var searchPath = "search.xml";
      if (searchPath.length === 0) {
        searchPath = "search.xml";
      }
      var path = "/" + searchPath;
      searchFunc(path, "search-input", "search-result");
    });
    </script>
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>Spring4配置文件详解 | 解忧杂货店 - 爱生活爱解忧</title>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN"  data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header" style="background: #333333;">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">解忧杂货店</a></h1>
        <h2 class="subtitle">爱生活爱解忧</h2>
      </div>
      
      <div class="logo">
        <img src="/images/logo.png" alt="logo">
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
        <li role="menuitem"><a href="/">首页</a></li>
        
        <li role="menuitem"><a href="/archives/">归档</a></li>
        
        <li role="menuitem"><a href="/categories/">分类</a></li>
        
        <li role="menuitem"><a href="/tags/">标签</a></li>
        
        <li role="menuitem"><a href="/about/">关于</a></li>
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            
<div id="post" class="page">
  
  <article class="article post card animate" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://liuzhuo19940206.github.io/2018/10/19/Spring4配置文件详解/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
       <meta itemprop="name" content="刘卓">
       <meta itemprop="description" content="hello,every body!">
       <meta itemprop="image" content="/images/avatar.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
       <meta itemprop="name" content="解忧杂货店">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">Spring4配置文件详解</h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2018-10-19T21:10:14+08:00">2018-10-19 21:10:14</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>
        </span>
        
        
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      <p>总结Spring4中的各种配置文件的信息。</p>
<a id="more"></a>
<p>欢迎大家补充，完善各种配置信息。</p>
<p>好的习惯，将会伴随你的一生。</p>
<p>开始今天的主题！！！</p>
<h3 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h3><hr>
<p>基本的加载properties配置文件</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;context:property-placeholder location=&quot;classpath*:/appConfig.properties&quot; /&gt;<br></code></pre></td></tr></table></figure>
<h4 id="JNDI方式"><a href="#JNDI方式" class="headerlink" title="JNDI方式"></a>JNDI方式</h4><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;jee:jndi-lookup id=&quot;dataSource&quot; jndi-name=&quot;/jdbc/mysqlDS&quot; resource-ref=&quot;true&quot;/&gt;<br></code></pre></td></tr></table></figure>
<p>jndi-name：指定JNDI中资源名称</p>
<p>resource-ref：如果应用程序运行在java应用程序服务器中，值设为true，这样jndi-name会自动加上java:comp/env/前缀</p>
<h4 id="数据连接池方式"><a href="#数据连接池方式" class="headerlink" title="数据连接池方式"></a>数据连接池方式</h4><h5 id="DBCP连接池："><a href="#DBCP连接池：" class="headerlink" title="DBCP连接池："></a>DBCP连接池：</h5><p>使用：org.apache.commons.dbcp.BasicDataSource进行配置<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;<br><br>  &lt;!-- 【必须】  数据库驱动--&gt;<br>  &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot; /&gt;<br><br>  &lt;!-- 【必须】 数据库连接地址 --&gt;<br>  &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;<br><br>  &lt;!-- 【必须】 数据库用户名 --&gt;<br>  &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;<br><br>  &lt;!-- 【必须】 数据库密码 --&gt;<br>  &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;<br><br>  &lt;!-- 可选 启动时创建的连接数 --&gt;<br>  &lt;property name=&quot;initialSize&quot; value=&quot;5&quot;/&gt;<br><br>  &lt;!-- 可选 同时可从池中分配的最多连接数，0无限制 --&gt;<br>  &lt;property name=&quot;maxActive&quot; value=&quot;10&quot;/&gt;<br><br>  &lt;!-- 可选 池中不会被释放的最多空闲连接数 0无限制 --&gt;<br>  &lt;property name=&quot;maxIdle&quot; value=&quot;&quot;/&gt;<br><br>  &lt;!-- 可选 同时能从语句池中分配的预处理语句最大值，0无限制 --&gt;<br>  &lt;property name=&quot;maxOpenPreparedStatement&quot; value=&quot;100&quot;/&gt;<br><br>  &lt;!-- 可选 抛异常前池等待连接回收最大时间（当无可用连接），-1无限等待 --&gt;<br>  &lt;property name=&quot;maxWait&quot; value=&quot;1000&quot;/&gt;<br><br>  &lt;!-- 可选 连接在池中保持空闲而不被回收的最大时间 --&gt;<br>  &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;2000&quot;/&gt;<br><br>  &lt;!-- 可选 不创建新连接情况下池中保持空闲的最小连接数 --&gt;<br>  &lt;property name=&quot;minIdle&quot; value=&quot;2&quot;/&gt;<br><br>  &lt;!-- 可选 布尔值，是否对预处理语句进行池管理 --&gt;<br>  &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot;/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<h5 id="C3P0连接池："><a href="#C3P0连接池：" class="headerlink" title="C3P0连接池："></a>C3P0连接池：</h5><p>使用：com.mchange.v2.c3p0.ComboPooledDataSource进行配置<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; destroy-method=&quot;close&quot;&gt;<br><br>  &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driver&#125;&quot; /&gt;<br>  &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;<br>  &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;<br>  &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;<br>  <br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<h5 id="alibaba-DRUID连接池："><a href="#alibaba-DRUID连接池：" class="headerlink" title="alibaba DRUID连接池："></a>alibaba DRUID连接池：</h5><p>使用：com.alibaba.druid.pool.DruidDataSource进行配置<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;  <br><br>   &lt;!-- 基本属性 url、user、password --&gt; <br>   &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc_url&#125;&quot; /&gt; <br>   &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc_user&#125;&quot; /&gt; <br>   &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc_password&#125;&quot; /&gt; <br>   &lt;!-- 配置初始化大小、最小、最大 --&gt; <br>   &lt;property name=&quot;initialSize&quot; value=&quot;1&quot; /&gt; <br>   &lt;property name=&quot;minIdle&quot; value=&quot;1&quot; /&gt;  <br>   &lt;property name=&quot;maxActive&quot; value=&quot;20&quot; /&gt; <br>   &lt;!-- 配置获取连接等待超时的时间 --&gt; <br>   &lt;property name=&quot;maxWait&quot; value=&quot;60000&quot; /&gt; <br>   &lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt; <br>   &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;60000&quot; /&gt; <br>   &lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt; <br>   &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot; /&gt; <br>   &lt;property name=&quot;validationQuery&quot; value=&quot;SELECT &apos;x&apos;&quot; /&gt; <br>   &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot; /&gt; <br>   &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot; /&gt; <br>   &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot; /&gt; <br>   &lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小 --&gt; <br>   &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot; /&gt; <br>   &lt;property name=&quot;maxPoolPreparedStatementPerConnectionSize&quot; value=&quot;20&quot; /&gt; <br>   &lt;!-- 配置监控统计拦截的filters，去掉后监控界面sql无法统计 --&gt; <br>   &lt;property name=&quot;filters&quot; value=&quot;stat&quot; /&gt;  <br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<h4 id="JDBC驱动的数据源"><a href="#JDBC驱动的数据源" class="headerlink" title="JDBC驱动的数据源"></a>JDBC驱动的数据源</h4><p>使用：</p>
<p>org.springframework.jdbc.datasource.SingleConnectionDataSource【每个链接请求会返回同一个连接，不推荐】</p>
<p>org.springframework.jdbc.datasource.DriverManagerDataSource进行配置<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;<br><br>  &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot; /&gt;<br>  &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;<br>  &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;<br>  &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<h3 id="操作数据库"><a href="#操作数据库" class="headerlink" title="操作数据库"></a>操作数据库</h3><hr>
<h4 id="spring-JDBC模板"><a href="#spring-JDBC模板" class="headerlink" title="spring JDBC模板"></a>spring JDBC模板</h4><p>模板类选择：</p>
<p>JdbcTemplate：提供最简单的数据访问等功能。</p>
<p>NamedParameterJdbcTemplate：通过该模板，可以把参数作为查询的条件传入方法中。</p>
<p>SimpleJdbcTemplate（推荐）：结合了一些自动装箱等功能，2.5以后，整合了NamedParameterJdbcTemplate。</p>
<p>配置方式：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.simple.SimpleJdbcTemplate&quot;&gt;<br>  &lt;constructor-arg ref=&quot;dataSource&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<h4 id="与ORM框架集成"><a href="#与ORM框架集成" class="headerlink" title="与ORM框架集成"></a>与ORM框架集成</h4><p>主要是配置spring的Session工厂（sessionFactory），可以使用到诸如延迟加载、预先抓取、级联复杂特性。</p>
<p>spring对ORM框架的支持提供提供了一些附加服务：</p>
<p>spring声明式事务集成支持</p>
<p>透明的异常处理</p>
<p>线程安全、轻量级的模板类</p>
<p>DAO支持</p>
<p>资源管理</p>
<h5 id="集成Hibernate方式：-hibernate4为例"><a href="#集成Hibernate方式：-hibernate4为例" class="headerlink" title="集成Hibernate方式：[hibernate4为例]"></a>集成Hibernate方式：[hibernate4为例]</h5><p>hibernate的HBM文件配置方式（Xxx.hbm.xml)：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate4.LocalSessionFactoryBean&quot;&gt;<br><br>  &lt;!-- 数据源 --&gt;<br>  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;<br>  &lt;!-- 映射文件形式--&gt;<br>  &lt;property name=&quot;mappingResources&quot;&gt;<br>     &lt;list&gt;<br>        &lt;value&gt;User.hbm.xml&lt;/value&gt;<br>     &lt;/list&gt;<br>  &lt;/property&gt;<br>  &lt;!-- Hibernate属性配置 --&gt;<br>  &lt;property name=&quot;hibernateProperties&quot;&gt;<br>     &lt;props&gt;<br>         &lt;prop key=&quot;dialect&quot;&gt;<br>            org.hibernate.dialect.MySQLDialect &lt;!-- 数据库方言 --&gt;<br>         &lt;/prop&gt;<br>        &lt;!-- ……其他 --&gt;<br>     &lt;/props&gt;<br>  &lt;/property&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<p>代码中使用注解的方式：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate4.LocalSessionFactoryBean&quot;&gt;<br><br>  &lt;!-- 数据源 --&gt;<br>  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;  <br>  &lt;!-- 自动扫描实体对象 tdxy.bean的包结构中存放实体类  --&gt;<br>  &lt;property name=&quot;packagesToScan&quot; value=&quot;com.test.entity&quot;/&gt;<br>  &lt;!-- hibernate的相关属性配置 --&gt;<br>  &lt;property name=&quot;hibernateProperties&quot;&gt;<br>     &lt;value&gt;<br>        &lt;!-- 设置数据库方言 --&gt;<br>        hibernate.dialect=org.hibernate.dialect.MySQLDialect<br>        &lt;!-- 设置自动创建|更新|验证数据库表结构 --&gt;<br>        hibernate.hbm2ddl.auto=update                 <br>        &lt;!-- 是否在控制台显示sql --&gt;<br>        hibernate.show_sql=true                 <br>        &lt;!-- 是否格式化sql，优化显示 --&gt;<br>        hibernate.format_sql=true                <br>        &lt;!-- 是否开启二级缓存 --&gt;<br>        hibernate.cache.use_second_level_cache=false                <br>        &lt;!-- 是否开启查询缓存 --&gt;<br>        hibernate.cache.use_query_cache=false                <br>        &lt;!-- 数据库批量查询最大数 --&gt;<br>        hibernate.jdbc.fetch_size=50<br>        &lt;!-- 数据库批量更新、添加、删除操作最大数  --&gt;<br>        hibernate.jdbc.batch_size=50                <br>        &lt;!-- 是否自动提交事务  --&gt;<br>        hibernate.connection.autocommit=true<br>        &lt;!-- 指定hibernate在何时释放JDBC连接  --&gt;<br>        hibernate.connection.release_mode=auto<br>        &lt;!-- 创建session方式 hibernate4.x 的方式  --&gt;<br>        hibernate.current_session_context_class=org.springframework.orm.hibernate4.SpringSessionContext<br>        &lt;!-- javax.persistence.validation.mode默认情况下是auto的，就是说如果不设置的话它是会自动去你的classpath下面找一个bean-validation**包，所以把它设置为none即可  --&gt;<br>        javax.persistence.validation.mode=none            <br>     &lt;/value&gt;<br>  &lt;/property&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<p>针对少量实体类，还可以通过annotatedClasses属性来将应用程序中所有的持久化类以全局定名的方式明确列出：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;property name=&quot;annotatedClasses&quot;&gt;<br>  &lt;list&gt;<br>     &lt;value&gt;com.demo.entity.User&lt;/value&gt;<br>     &lt;value&gt;com.demo.entity.Blog&lt;/value&gt;<br>  &lt;/list&gt;<br>&lt;/property&gt;<br></code></pre></td></tr></table></figure></p>
<p><strong>推荐使用packagesToScan属性扫描包方式。</strong></p>
<p>【构建不依赖于spring的Hibernate代码】<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs undefined">package com.demo.dao;<br><br>import org.hibernate.Session;<br>import org.hibernate.SessionFactory;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.stereotype.Repository;<br>import com.demo.entity.User;<br><br>@Repository<br>public class UserDaoImpl implements IUserDao  &#123;<br><br>  private SessionFactory sessionFactory;<br><br>  // 构造注入<br>  @Autowired<br>  public UserDaoImpl(SessionFactory sessionFactory) &#123;<br>     this.sessionFactory = sessionFactory;<br>  &#125;<br><br>  private Session currentSession()&#123;<br>     return sessionFactory.getCurrentSession();<br>  &#125;<br><br>  @Override<br>  public void addUser(User param) &#123;<br>     Session session = currentSession();<br>     session.save(param);<br>     System.out.println(&quot;Add User&quot;);<br>  &#125;<br><br>  @Override<br>  public User get(Integer id) &#123;<br>     return (User) currentSession().get(User.class, id);<br>  &#125;<br><br>  @Override<br>  public void save(User user) &#123;<br>     currentSession().update(user);<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></p>
<p>还需配置：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;context:component-scan base-package=&quot;com.demo.dao&quot;/&gt;<br></code></pre></td></tr></table></figure></p>
<p>就会像扫描其他注解一样扫描带@Repository注解的类到容器中。</p>
<h5 id="集成MyBatis方式"><a href="#集成MyBatis方式" class="headerlink" title="集成MyBatis方式"></a>集成MyBatis方式</h5><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;<br>  p:dataSource-ref=&quot;dataSource&quot; p:configLocation=&quot;classpath:mybatis-config.xml&quot;<br>  p:mapperLocations=&quot;classpath:com/demo/dao/*.xml&quot; /&gt;<br><br>&lt;!-- spring与mybatis整合配置，扫描所有dao --&gt;<br>&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;<br>  p:basePackage=&quot;com.demo.dao&quot; p:sqlSessionFactoryBeanName=&quot;sqlSessionFactory&quot; /&gt;<br></code></pre></td></tr></table></figure>
<h4 id="与其他JPA集成方式"><a href="#与其他JPA集成方式" class="headerlink" title="与其他JPA集成方式"></a>与其他JPA集成方式</h4><p>配置实体管理工厂</p>
<p>应用程序管理类型的JPA（LocalEntityManagerFactoryBean）：它的EntityManager是由EntityManagerFactory创建的；</p>
<p>容器管理类型的JPA（LocalContainerEntityManagerFactoryBean）：通过PersistenceProvider的createEntityManagerFactory()方法得到，即它的EntityManagerFactory是通过PersistenceProvider的createContainerEntityManagerFactory()方法得到。</p>
<p>使用应用程序管理类型的JPA</p>
<p>绝大部分配置文件来源于名为persistence.xml的配置文件，这个文件位置必须位于类路径下的WETA-INF目录下<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;persistence version=&quot;2.0&quot;<br>     xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;<br>     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>     xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;<br>     <br>  &lt;persistence-unit name=&quot;persistenceUnit&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;<br><br>     &lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;<br><br>     &lt;properties&gt;<br>        &lt;property name=&quot;hibernate.dialect&quot; value=&quot;org.hibernate.dialect.MySQL5Dialect&quot; /&gt;<br>        &lt;property name=&quot;hibernate.max_fetch_depth&quot; value=&quot;3&quot;/&gt;<br>        &lt;property name=&quot;hibernate.hbm2ddl.auto&quot; value=&quot;update&quot;/&gt;<br>        &lt;property name=&quot;hibernate.jdbc.fetch_size&quot; value=&quot;18&quot;/&gt;<br>        &lt;property name=&quot;hibernate.jdbc.batch_size&quot; value=&quot;10&quot;/&gt;<br>        &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;false&quot;/&gt;<br>        &lt;property name=&quot;hibernate.format_sql&quot; value=&quot;false&quot;/&gt;<br>     &lt;/properties&gt;<br><br>     &lt;class&gt;com.demo.entity.User&lt;/class&gt;<br>     &lt;class&gt;com.demo.entity.Blog&lt;/class&gt;<br>     &lt;!-- …… ……--&gt;<br>   &lt;/persistence-unit&gt;<br><br>&lt;/persistence&gt;<br></code></pre></td></tr></table></figure></p>
<p>这样在spring的配置文件中配置的信息就很少了：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;demo&quot; class=&quot;org.springframework.orm.jpa.LocalEntityManagerFactoryBean&quot;&gt;<br>  &lt;property name=&quot;persistenceUnit&quot; &gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<p>【TIPS】上面persistence.xml文件中的配置会出现问题：</p>
<p>如果每次请求EntityManagerFactory时都要定义持久化单元，代码回迅速膨胀</p>
<p>借助spring对JPA的支持，不再需要直接处理PersistenceProvider了，就是下面的容器管理的JPA！</p>
<p>使用容器管理类型的JPA</p>
<p>将数据源信息配置在spring的应用上下文中，而不是在persistence.xml文件中。<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;emf&quot; class=&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;&gt;<br>  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;<br>   &lt;!-- 指定使用的是哪一个厂商的JPA实现 如Hibernate --&gt;<br>  &lt;property name=&quot;jpaVendorAdapter&quot; ref=&quot;hibernateJpaVendorAdapter&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<p>配置JPA实现：</p>
<p>可选的有：EclipseLinkJpaVendorAdapter、HibernateJpaVendorAdapter、OpenJpaVendorAdapter、TopLinkJpaVendorAdapter</p>
<figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;hibernateJpaVendorAdapter&quot; class=&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;&gt;<br>  &lt;property name=&quot;database&quot; value=&quot;MYSQL&quot;/&gt;<br>  &lt;property name=&quot;showSql&quot; value=&quot;true&quot;/&gt;<br>  &lt;property name=&quot;generateDdl&quot; value=&quot;true&quot;/&gt;<br>  &lt;property name=&quot;databasePlatform&quot; value=&quot;org.hibernate.dialect.MySQL5Dialect&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p>【TIPS】database属性：属性值表示支持哪种数据库，下面Hibernate的JPA是一些支持的数据库：<br><img src="/images/20181019214107.png"></p>
<p><strong>【注】JNDI获取实体管理工厂：</strong></p>
<p>如果spring应用部署在应用服务器中，Spring可能已经创建好EntityManagerFactory并将其置于JNDI中等饭查询使用，这种情况可使用JNDI来获取对EntityManagerFactory的引用：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;jee:jndi-lookup id=&quot;emf&quot; jndi-name=&quot;persistence/testDS&quot;/&gt;<br></code></pre></td></tr></table></figure></p>
<p>编写基于JPA的DAO<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs undefined">package com.demo.dao;<br><br>import javax.persistence.EntityManager;<br>import javax.persistence.PersistenceContext;<br>import org.springframework.stereotype.Repository;<br>import org.springframework.transaction.annotation.Transactional;<br>import com.demo.entity.User;<br><br>@Repository<br>@Transactional<br>public class JpaDao implements IUserDao &#123;<br><br>  // 注入EntityManager<br>  @PersistenceContext<br>  private EntityManager em;<br><br>  // 使用EntityManager<br>  @Override<br>  public void addUser(User param) &#123;<br>     em.persist(param);<br>  &#125;<br><br>  @Override<br>  public User get(Integer id) &#123;<br>     return em.find(User.class, id);<br>  &#125;<br><br>  @Override<br>  public void save(User user) &#123;<br>     em.merge(user);<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></p>
<p>上面使用到了@PersistenceContext注解将EntityManager注入。</p>
<p>这样用需要在spring的上下文配置文件中配置一个PersistenceAnnotationBeanPostProcessor：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;!-- 使用EntityManager --&gt;<br>&lt;bean class=&quot;org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor&quot;/&gt;<br></code></pre></td></tr></table></figure></p>
<p>以上，是如何使用JDBC、Hibernate或JPA为spring应用程序构建持久层，至于选择哪种方案完全取决于偏好.</p>
<h3 id="Spring事务管理"><a href="#Spring事务管理" class="headerlink" title="Spring事务管理"></a>Spring事务管理</h3><p>通过毁掉机制将实际事务实现从事务性代码中抽象出来。</p>
<h4 id="选择事务管理器"><a href="#选择事务管理器" class="headerlink" title="选择事务管理器"></a>选择事务管理器</h4><p>事务管理器结构</p>
<p>事务处理流程：</p>
<p>开始事务-&gt;绑定资源-&gt;使用资源-&gt;完成事务-&gt;释放资源</p>
<h5 id="JDBC事务"><a href="#JDBC事务" class="headerlink" title="JDBC事务"></a>JDBC事务</h5><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;<br>     &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p>DataSourceTransactionManager通过调用java.sql.Connection来管理事务，由java.sql.Connection对象来提交、回滚事务。</p>
<h5 id="Hibernate事务"><a href="#Hibernate事务" class="headerlink" title="Hibernate事务"></a>Hibernate事务</h5><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;transactionManager&quot;<br>class=&quot;org.springframework.orm.hibernate4.HibernateTransactionManager&quot;&gt;<br>  &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p>HibernateTransactionManager通过将事务管理的职责委托给org.hibernate.Transaction对象，org.hibernate.Transaction对象从Hibernate Session中获取，然后由Transaction对象来提交、回滚事务。</p>
<h5 id="JPA事务"><a href="#JPA事务" class="headerlink" title="JPA事务"></a>JPA事务</h5><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;<br>  &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure>
<p>JpaTransactionManager只需要装配一个JPA实体管理工厂（EntityManagerFactory的任意实现），然后与由工厂产生的JPA EntityManager合作构建事务。</p>
<p>如果你还希望将事务应用于简单JDBC操作（JDBC操作使用的datasource和EntityManagerFactory使用的dataSource必须相同），那么JpaTransactionManager必须装配一个JpaDialect的实现：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;jpaDialect&quot; class=&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;/&gt;<br><br><br>&lt;!--然后将jpaDialect装配到transactionManager中 --&gt;<br>&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;<br>  &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot;/&gt;<br>  &lt;property name=&quot;jpaDialect&quot; ref=&quot;jpaDialect&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<h5 id="JTA事务"><a href="#JTA事务" class="headerlink" title="JTA事务"></a>JTA事务</h5><p>如果前面的事务管理器不能满足需求或事物需要跨多个事务资源（两个及以上数据库），需要使用JtaTrasactionManager了：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;transactionManager&quot;<br>  class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;&gt;<br>  &lt;property name=&quot;transactionManagerName&quot; value=&quot;java:/TrasactionManager&quot;/&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<p>JtaTransactionManager将事务委托给一个JTA的实现（java.transaction.UserTransaction和javax.transaction.TransactionManager），通过UserTransaction来操作事务。JTA规定了应用程序晕一个或多个数据源之间协调事务的标准API，transactionManagerName属性指定了要在JNDI上查找JTA事务管理器。</p>
<h4 id="Spring事务实现方式"><a href="#Spring事务实现方式" class="headerlink" title="Spring事务实现方式"></a>Spring事务实现方式</h4><p>1）编码事务</p>
<p>通过TransactionTemplate的回调机制，例如：（UserSeriveImpl.java）<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs undefined">public void addUser(final User u) &#123;<br><br>  TransactionTemplate temp = new TransactionTemplate();<br>  <br>  temp.execute(new TransactionCallback&lt;Void&gt;() &#123;<br>  <br>     @Override<br>     public Void doInTransaction(TransactionStatus txtStatus) &#123;<br>          // 要执行的事务代码<br>        try &#123;<br>           userDao.save(u);<br>        &#125; catch (RuntimeException e) &#123;<br>           e.printStackTrace();<br>           txtStatus.setRollbackOnly();<br>        &#125;<br>        return null;<br>     &#125;<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure></p>
<p>此时UserService需要如下装配：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;bean id=&quot;userSerive&quot; class=&quot;com.demo.service.UserServiceImpl&quot;&gt;<br>  &lt;property name=&quot;transactionTemplate&quot;&gt;<br>     &lt;bean class=&quot;org.springframework.transaction.support.TransactionTemplate&quot;&gt;<br>        &lt;property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot;/&gt;<br>     &lt;/bean&gt;<br>  &lt;/property&gt;<br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure></p>
<p>优点：可以完全控制事务边界，精确控制事务。</p>
<p>缺点：侵入性的，事务控制在代码中实现，耦合度高</p>
<p>2）声明式事务</p>
<p>传播行为</p>
<p>传播行为回答了新的事务是该被启动还是被挂起，或者方法是否要在事务环境中运行。</p>
<p>事务的传播行为都在org.springframework.transaction.TransactionDefinition接口中以常量的方式定义出来。</p>
<p>隔离级别</p>
<p>隔离级别定义了一个事务可能受其他并发事务影响的程度。</p>
<p>隔离级别都在org.springframework.transaction.TransactionDefinition接口中以常量的方式定义出来。</p>
<p>只读</p>
<p>事务启动的时候由数据库实施的，只有针对具备启动一个新事务传播行为（PROPAGATION_REQUIRED、PROPAGATION_REQUIRES_NEW和PROPAGATION_NESTED）的方法来说才有意义。【tips】如果使用Hibernate，将事务声明为只读会导致flush模式被设置为FLUSH_NEVER，这会告诉hibernate避免和数据库进行不必要的对象同步，并将所有的更新延迟到事务结束。</p>
<p>事务超时</p>
<p>长时间事务会导致一些不必要的数据库资源占用。</p>
<p>超时时钟会在事务开始时启动，只有针对具备启动一个新事务传播行为（PROPAGATION_REQUIRED、PROPAGATION_REQUIRES_NEW和PROPAGATION_NESTED）的方法来说才有意义。</p>
<p>回滚规则</p>
<p>这些规则定义了哪些异常会导致事务回滚哪些不会，默认情况下，运行时异常会回滚，检查异常不回滚，但是可以声明事务遇到检查异常回滚，运行时异常不回滚。</p>
<p>3）Spring在XML中定义事务</p>
<p>需要包括beans、aop、tx命名空间。<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;<br>  &lt;tx:attributes&gt;<br>     &lt;!-- 事务执行方式 REQUIRED：指定当前方法必需在事务环境中运行，<br>     如果当前有事务环境就加入当前正在执行的事务环境，<br>     如果当前没有事务，就新建一个事务。 这是默认值。 --&gt;<br>     &lt;tx:method name=&quot;create*&quot; propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;tx:method name=&quot;save*&quot;   propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;tx:method name=&quot;add*&quot;    propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;tx:method name=&quot;remove*&quot; propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;tx:method name=&quot;del*&quot;    propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;tx:method name=&quot;import*&quot; propagation=&quot;REQUIRED&quot; /&gt;<br>     &lt;!-- 指定当前方法以非事务方式执行操作，如果当前存在事务，就把当前事务挂起，等我以非事务的状态运行完，再继续原来的事务。 查询定义即可<br>        read-only=&quot;true&quot; 表示只读 --&gt;<br>     &lt;tx:method name=&quot;*&quot;       propagation=&quot;NOT_SUPPORTED&quot; read-only=&quot;true&quot; /&gt;<br>  &lt;/tx:attributes&gt;<br>&lt;/tx:advice&gt;<br></code></pre></td></tr></table></figure></p>
<p>其中&lt;tx:method /&gt;有很多属性用来帮助定义方法的事务策略：<br><img src="/images/20181019215056.png"></p>
<p>4）定义注解驱动的事务</p>
<p>在XML配置文件中添加：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;tx:annotation-driven/&gt;<br></code></pre></td></tr></table></figure></p>
<p>可通过transaction-manager属性（默认值”transactionManager”）来指定事务管理器，如：<br><figure class="hljs highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;tx:annotation-driven transaction-manager=&quot;txManager&quot;/&gt;<br></code></pre></td></tr></table></figure></p>
<p><code>&lt;tx:annotation-driven/&gt;</code>告诉Spring检查上下文中所有bean并检查使用到@Transactional注解的bean。</p>

    </main>
    <footer class="post-footer">
      
      <div class="post-tags">
        
        <a class="post-tag button" href="/tags/Spring/" rel="tag"><i class="fas fa-tags"></i>Spring</a>
        
      </div>
      
    </footer>
  </article>
  
  
<div class="reward" id="reward">
  <p>坚持原创技术分享，您的支持是我前进的动力！</p>
  <button id="reward-button" class="button" disable="enable">打赏</button>
  <div id="qr" class="qr" style="display: none;" aria-hidden="true">
    
    <div id="wechat">
      <img id="wechat_qr" src="/images/WeChatPay.png" alt="微信支付"/>
      <span>微信支付</span>
    </div>
    
    
    <div id="alipay">
      <img id="alipay_qr" src="/images/AliPay.png" alt="支付宝"/>
      <span>支付宝</span>
    </div>
    
    
  </div>
</div>


  
  
  <nav class="page-nav">
    <div class="page-nav-next page-nav-item">
      
      <a href="/2018/10/19/Spring中无处不在的Properties/" rel="next" title="Spring中无处不在的Properties"><i class="fas fa-angle-left"></i><span class="nav-title">Spring中无处不在的Properties</span></a>
      
    </div>
    <div class="page-nav-prev page-nav-item">
      
      <a href="/2018/10/20/spring-annotation-day-14/" rel="prev" title="spring_annotation_day_14"><span class="nav-title">spring_annotation_day_14</span><i class="fas fa-angle-right"></i></a>
      
    </div>
  </nav>
  
  
  

<div class="comments" id="comments">
  
  
  <div class="commentjs" id="comment-thread"></div>
  <link rel="stylesheet" href="/css/commentjs.css">
  <script defer type="text/javascript" src="/js/marked.min.js"></script>
  <script defer type="text/javascript" src="/js/timeago.min.js"></script>
  <script defer type="text/javascript" src="/js/highlight.min.js"></script>
  <script defer type="text/javascript" src="/js/commentjs.js"></script>
  <script type="text/javascript">
  $(document).ready(function () {
    getComments({
      "type": "github",
      "user": "liuzhuo19940206",
      "repo": "liuzhuo19940206.github.io",
      "client_id": "d67adf7d637efbea7a69",
      "client_secret": "e3958a48de708ffda0c1ff603f8b48793d43d1ae",
      "no_comment": "这个页面还没有评论，现在就去评论吧！",
      "go_to_comment": "去评论",
      "issue_title": "Spring4配置文件详解",
      "btn_class": "button",
      "comments_target": "#comment-thread"
    });
    marked.setOptions({
      "highlight": function (code, lang) {
        return hljs.highlightAuto(code).value;
      }
    });
    function mark() {
      var markdowns = document.getElementsByClassName("markdown");
      for (var i = 0; i < markdowns.length; ++i){
        if (markdowns[i].innerHTML) {
          markdowns[i].innerHTML = marked(markdowns[i].innerHTML);
        }
      }
    }
    window.addEventListener("DOMContentLoaded", mark, false);
    window.addEventListener("load", mark, false);
  });
  </script>
  
  
</div>



  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/images/background.png);">
  
  <div class="search">
    <div class="form-group">
      <i class="fas fa-search"></i><input type="search" id="search-input" name="q" results="0" placeholder="搜索" class="form-control"/>
    </div>
  </div>
  <div class="search-result-box" id="search-result"></div>
  
  
<div class="info sidebar-item" id="info">
  
  <img class="author-avatar" src="/images/avatar.jpg" alt="刘卓">
  
  <h1 class="author-name">刘卓</h1>
  <h2 class="author-description">hello,every body!</h2>
  <div class="site-count">
    
    <div class="archives-count">
      <div class="site-count-title">归档</div>
      <div><a href="/archives/">71</a></div>
    </div>
    
    
    
    <span class="site-count-divider divider">|</span>
    
    <div class="categories-count">
      <div class="site-count-title">分类</div>
      <div><a href="/categories/">32</a></div>
    </div>
    
    
    
    <span class="site-count-divider divider">|</span>
    
    <div class="tags-count">
      <div class="site-count-title">标签</div>
      <div><a href="/tags/">28</a></div>
    </div>
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="https://weibo.com/p/1005053310889015/home" target="_blank"><i class="fas fa-rss"></i>Click</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    
    
    
    <hr>
    <div class="post-toc sidebar-item" id="toc-div">
      <div><i class="fas fa-list-ol"></i>文章目录</div>
      <div class="post-toc-content"><ol class="list-group toc"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#配置数据源"><span class="toc-text">配置数据源</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#JNDI方式"><span class="toc-text">JNDI方式</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#数据连接池方式"><span class="toc-text">数据连接池方式</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#DBCP连接池："><span class="toc-text">DBCP连接池：</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#C3P0连接池："><span class="toc-text">C3P0连接池：</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#alibaba-DRUID连接池："><span class="toc-text">alibaba DRUID连接池：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#JDBC驱动的数据源"><span class="toc-text">JDBC驱动的数据源</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#操作数据库"><span class="toc-text">操作数据库</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#spring-JDBC模板"><span class="toc-text">spring JDBC模板</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#与ORM框架集成"><span class="toc-text">与ORM框架集成</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#集成Hibernate方式：-hibernate4为例"><span class="toc-text">集成Hibernate方式：[hibernate4为例]</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#集成MyBatis方式"><span class="toc-text">集成MyBatis方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#与其他JPA集成方式"><span class="toc-text">与其他JPA集成方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#Spring事务管理"><span class="toc-text">Spring事务管理</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#选择事务管理器"><span class="toc-text">选择事务管理器</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#JDBC事务"><span class="toc-text">JDBC事务</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#Hibernate事务"><span class="toc-text">Hibernate事务</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#JPA事务"><span class="toc-text">JPA事务</span></a></li><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#JTA事务"><span class="toc-text">JTA事务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#Spring事务实现方式"><span class="toc-text">Spring事务实现方式</span></a></li></ol></li></ol></div>
    </div>
    
    
    
    <hr>
    <div class="social-link sidebar-item">
      <div><i class="far fa-address-card"></i>社交链接</p></div>
      <ul>
        
        <li><i class="fas fa-envelope"></i><a href="mailto:575920824@qq.com" target="_blank">E-Mail</a></li>
        
        <li><i class="fab fa-github"></i><a href="https://github.com/liuzhuo19940206" target="_blank">GitHub</a></li>
        
        <li><i class="fab fa-weibo"></i><a href="https://weibo.com/p/1005053310889015/home" target="_blank">Weibo</a></li>
        
      </ul>
    </div>
    
    
    <hr>
    <div class="blogroll sidebar-item">
      <div><i class="fas fa-link"></i>友情链接</div>
      <ul>
        
        <li><i class="fas fa-link"></i><a href="http://gakkij.top" target="_blank">Gakki酱</a></li>
        
        <li><i class="fas fa-link"></i><a href="https://github.com/" target="_blank">GitHub</a></li>
        
        <li><i class="fas fa-link"></i><a href="https://dev.tencent.com/user" target="_blank">Coding</a></li>
        
        <li><i class="fas fa-link"></i><a href="https://developer.mozilla.org/" target="_blank">MDN</a></li>
        
        <li><i class="fas fa-link"></i><a href="https://mozilla.github.io/nunjucks/" target="_blank">Nunjucks</a></li>
        
      </ul>
    </div>
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer" style="background: #333333;">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author">刘卓</span><span class="year"><i class="far fa-copyright"></i>2018/10/10 - 2018</span>
        </div>
        
        <div class="busuanzi">
          <span id="busuanzi_container_site_pv"><i class="fas fa-eye" aria-label="站点点击量" aria-hidden="false"></i><span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv"><i class="fas fa-user" aria-label="站点用户数" aria-hidden="false"></i><span id="busuanzi_value_site_uv"></span></span><span id="busuanzi_container_page_pv"><i class="far fa-file-alt"></i><span id="busuanzi_value_page_pv" aria-label="页面点击量" aria-hidden="false"></span></span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
          托管于<i class="fab fa-github-alt"></i><a href="https://github.com/liuzhuo19940206/liuzhuo19940206.github.io" target="_blank">GitHub Pages</a>
          
        </div>
        <div class="powered-by">
          由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 
        </div>
      </div>
    </div>
  </div>
</footer>
<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  </body>
</html>
